<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ì°¨ëŒ€ë²ˆí˜¸ ë“±ë¡ ì‹œìŠ¤í…œ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
<style>
  :root { --ci-blue: #2f6286; --ci-green: #72bf44; --ci-dark: #231f20; --ci-white: #ffffff; }
  body, html { margin: 0; padding: 0; font-family: 'Noto Sans KR', sans-serif; background-color: #f5f7fa; -webkit-user-select:none; user-select:none; }
  
  .inquiry-container { max-width: 600px; margin: 40px auto; padding: 30px; background-color: var(--ci-white); border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); position: relative; }
  
  .nav-header { display: flex; justify-content: flex-end; margin-bottom: 10px; }
  .home-btn { text-decoration: none; font-size: 13px; color: #888; font-weight: 500; display: flex; align-items: center; transition: color 0.3s; }
  .home-btn:hover { color: var(--ci-blue); }

  .inquiry-container h2 { text-align: center; margin-bottom: 25px; color: var(--ci-dark); font-size: 24px; font-weight: 800; }
  .required-mark { color: #e74c3c; margin-left: 3px; font-weight: bold; }

  .privacy-box { background-color: #f9f9f9; padding: 15px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #eee; }
  .privacy-header { display: flex; align-items: center; margin-bottom: 8px; }
  .privacy-check { font-size: 14px; font-weight: bold; color: var(--ci-dark); cursor: pointer; display: flex; align-items: center; }
  .privacy-check input { width: 18px; height: 18px; margin-right: 8px; accent-color: var(--ci-blue); cursor: pointer; }
  .privacy-content { font-size: 12px; color: #666; background-color: #fff; padding: 10px; border: 1px solid #ddd; border-radius: 4px; height: 60px; overflow-y: auto; line-height: 1.5; }
  .optional-mark { color: #888; font-weight: normal; font-size: 12px; margin-left: 5px; }

  .form-row { display: flex; gap: 15px; margin-bottom: 15px; }
  .form-row .form-group { flex: 1; margin-bottom: 0; position: relative; }
  .form-group { margin-bottom: 15px; }
  .form-group label { display: block; margin-bottom: 6px; font-weight: 700; font-size: 13px; color: #555; }
  .form-group input[type="text"], .form-group select, .form-group input[type="file"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 15px; transition: border 0.3s; }
  .form-group input:focus, .form-group select:focus { border-color: var(--ci-blue); outline: none; }

  .suggestions-list { position: absolute; top: 100%; left: 0; width: 100%; max-height: 200px; overflow-y: auto; background: #fff; border: 1px solid #ccc; border-radius: 0 0 6px 6px; z-index: 1000; list-style: none; padding: 0; margin: 0; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  .suggestions-list li { padding: 12px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 14px; }
  .suggestions-list li:hover { background-color: #f0f8ff; color: var(--ci-blue); }
  .no-result-item { padding: 12px; color: #999; font-size: 13px; text-align: center; }

  .serial-guide-box { background-color: #eef6fb; border: 1px solid #dbe2e8; border-radius: 6px; padding: 12px; margin-bottom: 10px; text-align: center; }
  .serial-guide-box img { max-width: 100%; border-radius: 4px; border: 1px solid #ccc; margin-bottom: 5px; }
  .serial-guide-text { font-size: 12px; color: var(--ci-blue); margin-top: 5px; font-weight: 500; }
  .error-msg { color: #e74c3c; font-size: 12px; margin-top: 5px; display: none; font-weight: bold; }
  .store-info-display { font-size: 13px; color: var(--ci-dark); background-color: #f2f2f2; padding: 12px; border-radius: 6px; margin-top: 5px; display: none; line-height: 1.6; border-left: 3px solid var(--ci-green); }

  .submit-btn { width: 100%; padding: 16px; background-color: var(--ci-blue); color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 15px; font-weight: 800; transition: background 0.3s; }
  .submit-btn:hover { background-color: #244d6b; }
  .submit-btn:disabled { background-color: #ccc; cursor: not-allowed; }

  /* [NEW] ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ */
  .loading-container { 
    display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
    align-items: center; 
    justify-content: center; 
    margin-top: 15px; 
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
  }
  .spinner {
    border: 3px solid #f3f3f3; /* íšŒìƒ‰ í…Œë‘ë¦¬ */
    border-top: 3px solid var(--ci-blue); /* íŒŒë€ìƒ‰ í¬ì¸íŠ¸ */
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    margin-right: 10px;
  }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  .loading-msg { font-size: 13px; font-weight: bold; color: var(--ci-dark); }

  .footer-logo { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px dashed #eee; }
  .footer-logo img { height: 24px; opacity: 0.8; }

  @media (max-width: 500px) { .inquiry-container { margin: 15px; padding: 20px; } .form-row { flex-direction: column; gap: 0; } }
</style>
</head>
<body oncontextmenu="return false" ondragstart="return false" onselectstart="return false">

<div class="inquiry-container">
  <div class="nav-header"><a href="./main.html" class="home-btn">ğŸ  ë©”ì¸ìœ¼ë¡œ</a></div>
  <h2>ì°¨ëŒ€ë²ˆí˜¸ ë“±ë¡ ë° ë³´ì¦ ì—°ì¥</h2>
  
  <form id="registForm">
    <div class="privacy-box">
      <div class="privacy-header"><label class="privacy-check"><input type="checkbox" id="privacyAgree">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. <span class="required-mark">(í•„ìˆ˜)</span></label></div>
      <div class="privacy-content"><strong>[ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì ]</strong><br>ê³ ê°ë‹˜ì˜ ì œí’ˆ ì •í’ˆ ë“±ë¡ í™•ì¸ ë° ë³´ì¦ ê¸°ê°„ ì—°ì¥ ì„œë¹„ìŠ¤ ì œê³µ, AS ì ‘ìˆ˜ ì‹œ ì‹ ì†í•œ ê³ ê° í™•ì¸, ê·¸ë¦¬ê³  ì œí’ˆ ê´€ë ¨ ì¤‘ìš” ì—…ë°ì´íŠ¸ ì•ˆë‚´ë¥¼ ìœ„í•´ í•„ìš”í•œ ìµœì†Œí•œì˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤.</div>
    </div>
    <div class="privacy-box">
      <div class="privacy-header"><label class="privacy-check"><input type="checkbox" id="marketingAgree">ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë° í™œìš©ì— ë™ì˜í•©ë‹ˆë‹¤. <span class="optional-mark">(ì„ íƒ)</span></label></div>
      <div class="privacy-content"><strong>[ë§ˆì¼€íŒ… í™œìš© ë™ì˜]</strong><br>ì‹ ì œí’ˆ ì¶œì‹œ, ì´ë²¤íŠ¸ ë° í”„ë¡œëª¨ì…˜ ì•ˆë‚´ ë“± í€„ë¦¬ìŠ¤í¬ì¸ ì˜ ë‹¤ì–‘í•œ í˜œíƒ ì •ë³´ë¥¼ ë°›ì•„ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
    </div>

    <div class="form-group">
      <label for="serialNo">ì°¨ëŒ€ë²ˆí˜¸ <span class="required-mark">*</span></label>
      <div class="serial-guide-box">
        <img src="https://placehold.co/400x150/png?text=Serial+Number+Location" alt="ì°¨ëŒ€ë²ˆí˜¸ ì˜ˆì‹œ">
        <div class="serial-guide-text">ğŸ’¡ ì°¨ëŒ€ë²ˆí˜¸ëŠ” ëª¨ë¸ë³„ë¡œ ìœ„ì¹˜ê°€ ë‹¤ë¦…ë‹ˆë‹¤(BBì‰˜í•˜ë‹¨, ì¤‘ì•™ëª¨í„° ì˜†, BBíœ„ í•˜ë‹¨ ë’¤ìª½)</div>
      </div>
      <input type="text" id="serialNo" placeholder="ì°¨ëŒ€ ë²ˆí˜¸ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”" autocomplete="off">
      <p id="serialError" class="error-msg">ì˜¬ë°”ë¥¸ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.</p>
    </div>

    <div class="form-row">
      <div class="form-group"><label for="userName">ì´ë¦„ <span class="required-mark">*</span></label><input type="text" id="userName" placeholder="ì„±í•¨ ì…ë ¥" autocomplete="off"></div>
      <div class="form-group"><label for="userPhone">ì „í™”ë²ˆí˜¸ <span class="required-mark">*</span></label><input type="text" id="userPhone" placeholder="010-0000-0000" maxlength="13" autocomplete="off"></div>
    </div>

    <div class="form-row">
      <div class="form-group"><label for="productSelect">êµ¬ì…í•˜ì‹  ëª¨ë¸ <span class="required-mark">*</span></label><select id="productSelect"><option value="">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</option></select></div>
      <div class="form-group">
        <label for="storeInput">êµ¬ì… ë§¤ì¥ (ê²€ìƒ‰) <span class="required-mark">*</span></label>
        <input type="text" id="storeInput" placeholder="ë§¤ì¥ëª…, ëŒ€ë¦¬ì ëª…, ì£¼ì†Œ ê²€ìƒ‰" autocomplete="off">
        <input type="hidden" id="storeCode">
        <ul id="suggestions" class="suggestions-list"></ul>
        <div id="storeInfoDisplay" class="store-info-display"></div>
      </div>
    </div>
    
    <div class="form-group">
      <label for="receiptFile">êµ¬ë§¤ ì˜ìˆ˜ì¦ ì²¨ë¶€ (ì´ë¯¸ì§€) <span class="required-mark">*</span></label>
      <input type="file" id="receiptFile" accept="image/*,.pdf">
      <div style="font-size:11px; color:#e74c3c; margin-top:5px; font-weight:bold;">* 5MB ì´í•˜ì˜ ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
    </div>

    <button type="button" class="submit-btn" onclick="submitForm()">ë“±ë¡ ì‹ ì²­í•˜ê¸°</button>
    
    <div id="loadingArea" class="loading-container">
      <div class="spinner"></div>
      <span class="loading-msg">ì‚¬ì§„ ì—…ë¡œë“œ ë° ë“±ë¡ ì¤‘ì…ë‹ˆë‹¤... (ì•½ 3~5ì´ˆ ì†Œìš”)</span>
    </div>

  </form>
  <div class="footer-logo"><img src="https://via.placeholder.com/150x40/231f20/ffffff?text=QUALI+SPORTS" alt="QUALI SPORTS"></div>
</div>

<script>
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyy02EOo87dG4BWco1kbLO3O9BXwFSUKy-olHVwUim_E_07Azl5tl-e40UO1uBqoyeJ/exec"; 
  const MAX_FILE_SIZE = 5 * 1024 * 1024;
  let ALL_STORES = [], STORE_DATA_MAP = {}; 

  window.addEventListener("pageshow", function(event) {
    if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
      document.getElementById("registForm").reset();
      document.getElementById("storeInfoDisplay").style.display = "none";
      document.getElementById("serialError").style.display = "none";
      setButtonState(true);
      document.getElementById("loadingArea").style.display = "none"; // ë¡œë”© ìˆ¨ê¹€
    }
  });

  document.addEventListener("DOMContentLoaded", function() {
    fetch(WEB_APP_URL).then(r => r.json()).then(data => {
        const productSelect = document.getElementById("productSelect");
        updateSelectOptions(productSelect, data.products, "ì œí’ˆ ëª¨ë¸ ì„ íƒ");
        ALL_STORES = data.stores; STORE_DATA_MAP = {}; 
        data.stores.forEach(store => { STORE_DATA_MAP[store.name] = store; });
        document.getElementById("storeInput").placeholder = "ë§¤ì¥ëª…, ëŒ€ë¦¬ì ëª…, ì£¼ì†Œ ê²€ìƒ‰";
      }).catch(err => console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨")); 
  });

  const receiptFile = document.getElementById("receiptFile");
  receiptFile.addEventListener("change", function() {
    if (this.files.length > 0 && this.files[0].size > MAX_FILE_SIZE) { alert("âŒ íŒŒì¼ ìš©ëŸ‰ì´ ë„ˆë¬´ í½ë‹ˆë‹¤! (5MB ì œí•œ)"); this.value = ""; }
  });

  const storeInput = document.getElementById("storeInput");
  const storeCodeInput = document.getElementById("storeCode");
  const suggestions = document.getElementById("suggestions");
  const infoDisplay = document.getElementById("storeInfoDisplay");

  storeInput.addEventListener("input", function() {
    const keyword = this.value.toLowerCase().trim();
    suggestions.innerHTML = ""; infoDisplay.style.display = "none"; 
    if (keyword.length === 0) { suggestions.style.display = "none"; return; }
    const matched = ALL_STORES.filter(store => {
      return store.name.toLowerCase().includes(keyword) || (store.alias && store.alias.toLowerCase().includes(keyword)) || (store.addr && store.addr.toLowerCase().includes(keyword)) || (store.agency && store.agency.toLowerCase().includes(keyword));
    });
    if (matched.length > 0) {
      suggestions.style.display = "block";
      matched.forEach(store => {
        const li = document.createElement("li"); li.innerText = store.agency ? `${store.name} (${store.agency})` : store.name; 
        li.addEventListener("click", function() { selectStore(store); }); suggestions.appendChild(li);
      });
    } else { suggestions.style.display = "block"; const li = document.createElement("li"); li.innerText = "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."; li.className = "no-result-item"; suggestions.appendChild(li); }
  });

  function selectStore(storeObj) {
    storeInput.value = storeObj.name; storeCodeInput.value = storeObj.code; suggestions.style.display = "none"; 
    infoDisplay.style.display = "block"; infoDisplay.innerHTML = `ğŸ“ <b>ì£¼ì†Œ:</b> ${storeObj.addr || "ì—†ìŒ"}<br>ğŸ“ <b>ì—°ë½ì²˜:</b> ${storeObj.phone || "ì—†ìŒ"}`; storeInput.style.border = "1px solid #ccc";
  }
  document.addEventListener("click", function(e) { if (!storeInput.contains(e.target) && !suggestions.contains(e.target)) suggestions.style.display = "none"; });

  const phoneInput = document.getElementById("userPhone");
  phoneInput.addEventListener('input', function(e) {
    let val = e.target.value.replace(/[^0-9]/g, '');
    if (val.length > 3 && val.length <= 7) val = val.slice(0, 3) + "-" + val.slice(3); else if (val.length > 7) val = val.slice(0, 3) + "-" + val.slice(3, 7) + "-" + val.slice(7);
    e.target.value = val.slice(0, 13);
  });

  const serialInput = document.getElementById("serialNo");
  const serialError = document.getElementById("serialError");
  const submitBtn = document.querySelector(".submit-btn");
  serialInput.addEventListener("blur", function() {
    const val = serialInput.value.trim(); if (val.length < 1) return; 
    serialError.style.display = "block"; serialError.style.color = "var(--ci-blue)"; serialError.innerText = "í™•ì¸ ì¤‘..."; setButtonState(false);
    fetch(WEB_APP_URL + "?type=check&no=" + val).then(r => r.json()).then(d => {
        if (d.status === "ok") { serialError.style.color = "var(--ci-green)"; serialError.innerText = "âœ… " + d.message; setButtonState(true); } 
        else { serialError.style.color = "#e74c3c"; serialError.innerText = "âŒ " + d.message; setButtonState(false); }
    }).catch(e => { serialError.innerText = ""; setButtonState(true); });
  });

  function updateSelectOptions(el, items, defText) { el.innerHTML = ""; const opt = document.createElement("option"); opt.value = ""; opt.text = defText; el.add(opt); if(items) items.forEach(i => { const o = document.createElement("option"); o.value = i; o.text = i; el.add(o); }); }
  function setButtonState(e) { submitBtn.disabled = !e; submitBtn.style.backgroundColor = e ? "var(--ci-blue)" : "#ccc"; }

  function submitForm() {
    const userName = document.getElementById("userName").value;
    const userPhone = document.getElementById("userPhone").value;
    const product = document.getElementById("productSelect").value;
    const storeName = document.getElementById("storeInput").value;
    const storeCode = document.getElementById("storeCode").value; 
    const serialNo = document.getElementById("serialNo").value;
    const privacyAgree = document.getElementById("privacyAgree").checked;
    const marketingAgree = document.getElementById("marketingAgree").checked;
    const fileInput = document.getElementById("receiptFile");

    if (!privacyAgree) return alert("ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•´ì•¼ í•©ë‹ˆë‹¤.");
    if (!serialNo) return alert("ì°¨ëŒ€ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  í™•ì¸ë°›ìœ¼ì„¸ìš”.");
    if (!userName) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    if (!userPhone) return alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    if (!product) return alert("ì œí’ˆ ëª¨ë¸ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (!storeName || !storeCode) return alert("êµ¬ì… ë§¤ì¥ì„ ëª©ë¡ì—ì„œ ì •í™•íˆ ì„ íƒí•´ì£¼ì„¸ìš”.");
    if (fileInput.files.length === 0) return alert("êµ¬ë§¤ ì˜ìˆ˜ì¦ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.");
    if (fileInput.files[0].size > MAX_FILE_SIZE) return alert("íŒŒì¼ ìš©ëŸ‰ì´ ë„ˆë¬´ í½ë‹ˆë‹¤!");

    setButtonState(false); // ë²„íŠ¼ ë¹„í™œì„±í™”
    document.getElementById("loadingArea").style.display = "flex"; // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ

    const formData = { userName, userPhone, product, storeName, storeCode, serialNo, marketingConsent: marketingAgree };
    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
      formData.fileName = file.name; formData.mimeType = file.type; formData.fileData = e.target.result.split(",")[1];
      sendData(formData);
    };
    reader.readAsDataURL(file);
  }

  function sendData(dataObj) {
    fetch(WEB_APP_URL, { method: "POST", headers: { "Content-Type": "text/plain;charset=utf-8" }, body: JSON.stringify(dataObj) })
    .then(r => r.json()).then(res => {
      if (res.result === "success") {
        alert("âœ… ì°¨ëŒ€ë²ˆí˜¸ ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\në“±ë¡ ë‚´ì—­ í™•ì¸ í˜ì´ì§€ë¡œ ìë™ ì´ë™í•©ë‹ˆë‹¤.");
        window.location.href = "./product_check.html?name=" + encodeURIComponent(dataObj.userName) + "&phone=" + encodeURIComponent(dataObj.userPhone);
      } else { alert("ì˜¤ë¥˜ ë°œìƒ: " + res.message); setButtonState(true); document.getElementById("loadingArea").style.display = "none"; }
    }).catch(e => { alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜"); setButtonState(true); document.getElementById("loadingArea").style.display = "none"; });
  }
  document.addEventListener('keydown', function(e) { if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && e.keyCode === 73) || (e.ctrlKey && e.keyCode === 85)) { e.preventDefault(); return false; } });
</script>
</body>
</html>